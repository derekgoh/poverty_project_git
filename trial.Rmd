---
title: "Untitled"
output: html_document
---
```{r}
library(plyr)
library(dplyr)
library(ggplot2)
shortlistpie <- read.csv("shortlistpie.csv")
a <- count(shortlistpie, "Education")
b <- rownames(a[1])
c <- a[, 2]

```

```{r}
plot_ly(shortlistpie, labels = ~b, values = ~c, type = 'pie') %>%
  layout(title = 'United States Personal Expenditures by Categories in 1960',
         xaxis = list(showgrid = FALSE, zeroline = FALSE, showticklabels = FALSE),
         yaxis = list(showgrid = FALSE, zeroline = FALSE, showticklabels = FALSE))
```

```{r}
ex_USPersonalExpenditure <- data.frame("Categorie" = rownames(USPersonalExpenditure), USPersonalExpenditure)
usexp_data <- ex_USPersonalExpenditure[,c('Categorie', 'X1960')]
plot_ly(usexp_data, labels = ~Categorie, values = ~X1960, type = 'pie') %>%
  layout(title = 'United States Personal Expenditures by Categories in 1960',
         xaxis = list(showgrid = FALSE, zeroline = FALSE, showticklabels = FALSE),
         yaxis = list(showgrid = FALSE, zeroline = FALSE, showticklabels = FALSE))
```

```{r}
Reserve_Data <- aggregate(.~Gender, FUN = sum, data = shortlistpie)
Reserve_Data
```

```{r}
plot_ly(shortlistpie, labels = ~b, values = ~c, type = 'pie') %>%
  layout(title = toTitleCase(input$plot_title),
         xaxis = list(showgrid = FALSE, zeroline = FALSE, showticklabels = FALSE),
         yaxis = list(showgrid = FALSE, zeroline = FALSE, showticklabels = FALSE))
```

```{r}
a <- count(shortlistpie, "Education")
a
b <- rownames(a[1])
c <- a[, 2]
frame <- data.frame(b, c)
frame
d <- ggplot(shortlistpie, aes(x = factor(1), y = factor(b), fill = factor(c))) + 
  geom_bar(stat = "identity", width = 1, position = position_fill())
d <- d + facet_grid(facets =. ~Gender)
d <- d + coord_polar(theta = "y")
d
```

```{r}
library(reshape2)
f <- data.frame(input$x, input$y)
data.m <- melt(table(f))
names(data.m)[3] <- "count"
m1 <- ddply(data.m, .(input$x), summarize, ratio = count/sum(count))
m2 <- data.m[order(data.m$input$x), ]
mydf <- data.frame(m2, ratio = m1$ratio)
mydf


d <- ggplot(mydf, aes(x = "", y = ratio, fill = Gender)) + 
  geom_bar(stat = "identity", width = 1) + 
  coord_polar("y", start = 0) + 
  facet_wrap(~shortlistpie.Education) +
  theme_void()

d
```

```{r}
library(reshape2)
f <- data.frame(shortlistpie$Education, shortlistpie$Gender)
data.m <- melt(table(f))
names(data.m)[3] <- "count"
names(data.m)[1] <- "educ"
names(data.m)[2] <- "gend"
data.m
m1 <- ddply(data.m, .(gend), summarize, ratio = count/sum(count))
m2 <- data.m[order(data.m$gend), ]
mydf <- data.frame(m2, ratio = m1$ratio)
mydf


d <- ggplot(mydf, aes(x = "", y = ratio, fill = educ)) + 
  geom_bar(stat = "identity", width = 1) + 
  coord_polar("y", start = 0) + 
  facet_wrap( ~ gend) +
  theme_void() 

d
```



```{r}
f1 <- f %>%
  group_by(shortlistpie.Gender) %>%
  count() %>%
  mutate(per = paste0(round(100*freq/sum(freq), 2), '%')) %>%
  arrange(shortlistpie.Gender)

f1
```

```{r}
newdata <- data.frame(shortlistpie$Education, shortlistpie$Gender)
data.m <- melt(table(newdata))
names(data.m)[3] <- "count"
m1 <- ddply(data.m, .(shortlistpie.Gender), summarize, ratio = count/sum(count))
m2 <- data.m[order(data.m$shortlistpie.Gender), ]
mydf <- data.frame(m2, ratio = m1$ratio)
mydf
```

```{r}
shortlistpied <- shortlistpie %>%
  group_by(Education, Gender) %>%
  summarize(Percentage = n()) %>%
  group_by(Gender) %>%
  mutate(Percentage = Percentage / sum(Percentage) * 100) %>%
  arrange(Gender)

shortlistpied
```

```{r}
shortlistpied <- shortlistpie %>%
  group_by(Education, Gender) %>%
  summarize(Percentage = n()) %>%
  group_by(Gender) %>%
  mutate(Percentage = Percentage / sum(Percentage) * 100) %>%
  arrange(Gender)

print(shortlistpied)

d <- ggplot(shortlistpied, aes(x = "", y = Percentage, fill = Education)) + 
  geom_bar(stat = "identity", width = 1) + 
  coord_polar("y", start = 0) + 
  facet_wrap( ~Gender) +
  theme_void() 

d
```

 shortlistpied <- reactive({
    shortlistpie %>% 
      group_by(Gender, Education) %>% 
      summarize(Percentage = n()) %>%
      group_by(Education) %>%
      mutate(Percentage = Percentage / sum(Percentage) * 100) %>%
      arrange(Education)
  })
  
  output$plot2 <- renderPlot({
    if (input$type == "Pie Chart") {
      print(shortlistpied())
      ggplot(shortlistpied(), aes(x = "", y = Percentage, fill = Gender)) + 
        geom_bar(stat = "identity", width = 1) + 
        coord_polar("y", start = 0) + 
        facet_wrap( ~Education) +
        theme_void()
    } else NULL
  })
  
  shortlistpied <- reactive({
    shortlistpie %>% 
      group_by(input$y, input$x) %>% 
      summarize(Percentage = n()) %>%
      group_by(input$x) %>%
      mutate(Percentage = Percentage / sum(Percentage) * 100) %>%
      arrange(input$x)
    
    return(shortlistpied)
  })
  
  output$plot2 <- renderPlot({
    if (input$type == "Pie Chart") {
        ggplot(shortlistpied(), aes_string(x = "", y = 'Percentage', fill = input$y)) + 
        geom_bar(stat = "identity", width = 1) + 
        coord_polar("y", start = 0) + 
        facet_wrap( ~input$x) +
        theme_void()
    } else NULL
  })
  
```{r}
shortlist <- read.csv("shortlist.csv")
xy3table <- table(shortlist$imp_educat, shortlist$imp_female)
xy3table

```

```{r}
mytab <- shortlist %>% 
      select(imp_billindsev, r_age) 
print (mytab)
```

```{r}
b <- shortlist %>%
  group_by(imp_billindsev) %>%
  summarize(count = n(), 
            totalB = sum(as.numeric(r_age)), 
            meanB = totalB / count)


print(b)
```


```{r}
ggplot(data = b, aes(x = imp_educat, y = meanB)) +
        geom_col() +
        labs(x = "vweb",
             y = "wevwe")
```

```{r}
sum(shortlist$imp_educat == 1)
```


```{r}
edited <- read.csv("for_Derek.csv")
colnames(edited)
str(edited$imp_race)
```

```{r}
levels(edited$imp_race)
as.character(levels(edited$imp_race))
as.numeric(as.character(levels(edited$imp_race)))
```

```{r}
library(readr)
parse_number(edited$imp_race)
```


```{r}
count(filter(edited, spmpov == 0 & imp_female == 0))
count(edited, imp_female == 0)
```

```{r}
str(edited$imp_race)
```

```{r}
b <- edited %>%
  group_by(sevhard, imp_educat) %>% 
  summarize(Percentage = n()) %>%
  group_by(sevhard) %>%
  mutate(Percentage = Percentage / sum(Percentage) * 100) %>%
  arrange(sevhard)

b
```

```{r}
count(filter(edited, sevhard == 0 & imp_educat == 1))
count(edited, imp_educat == 1)
```

```{r}
describe(edited)
```
```{r}
g <- read.csv("finaldata.csv")
str(g$faca)
z <- g %>%
  summarize(a = mean(faca*n()))
z
```

```{r}
g$respondent_age <- cut(g$respondent_age, breaks = c(-1, 34, 44, 54, 64, 120), label = c("a", "b", "c", "d", "e"), ordered = TRUE)
str(g$respondent_age)
```

```{r}
completeFun <- function(data, desiredCols) {
  completeVec <- complete.cases(data[, desiredCols])
  return(data[completeVec, ])
}

nrow(completeFun(g, c("SPM_household_resources_y2", "gender")))

```

```{r}
g1 %>%
  complete.cases(g[, c("age", "SPM_household_resources_y1")]) %>% 
  sum()
  
```

```{r}
  edited_stackbar <- reactive ({
    completeFun(data_source(), c(input$x, input$y)) %>%
      group_by_(input$x, input$y) %>%
      summarize(Percentage = n()) %>%
      group_by_(input$x) %>%
      mutate(Percentage = Percentage / sum(Percentage) * 100)
```


```{r}
g1 <- 
  g %>%
      group_by_("gender", "number_of_children") %>%
      na.omit()  %>%
      summarize(Percentage = mean(fach*n()))  %>%
      group_by_("number_of_children") %>%
      mutate(Percentage = (Percentage / sum(Percentage)) * 100) %>%
      arrange_("number_of_children")
g1
```

```{r}
d <- read.csv("test.csv")
```

```{r}
edited_stackbar <- 
  completeFun(d, c("in_poverty_SPM", "in_poverty_SPM_y1", "in_poverty_SPM_y2")) %>%
      summarize(Percentage = n())

edited_stackbar
```

```{r}
d$in_poverty_SPM <- factor(parse_number(d$in_poverty_SPM), 
                                 levels = c(0:1), 
                                 labels = c("Not in Poverty", "Poverty"))
  
d$in_poverty_SPM_y1 <- factor(parse_number(d$in_poverty_SPM_y1), 
                                     levels = c(0:1), 
                                     labels = c("Not in Poverty", "Poverty"))
  
d$in_poverty_SPM_y2 <- factor(parse_number(d$in_poverty_SPM_y2), 
                                 levels = c(0:1), 
                                 labels = c("Not in Poverty", "Poverty"))

edited_stackbar <- d %>%
  group_by("in_poverty_SPM") %>%
  summarize(Percentage = n()) %>%
  group_by("in_poverty_SPM") %>%
  mutate(Percentage = Percentage / sum(Percentage) * 100)

edited_stackbar
```

```{r}
a <- read.csv("finaldata.csv")
```

```{r}
edited_stackbar <- a %>%
  complete.cases(a, c(gender, SPM_household_resources)) %>%
    group_by_(race, SPM_household_resources) %>%
    summarize(Percentage = factor*n()) %>%
    group_by_(race) %>%
    mutate(Percentage = Percentage / sum(Percentage) * 100) %>%
    arrange_(race) %>%
    mutate(label_pos = cumsum(Percentage) - Percentage / 2,
           perc_text = paste0(round(Percentage), "%"))


```

